"bundle";!function(){var a=System.amdDefine;a("app.html!github:systemjs/plugin-text@0.0.11.js",[],function(){return'<template><require from="font-awesome/css/font-awesome.min.css"></require><require from="../styles/styles.css"></require><!-- --><nav class="navbar navbar-expand-sm navbar-light bg-warning"><a class="navbar-brand" href="#/">TEST Client </a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto"><li repeat.for="row of router.navigation" class="nav-item ${row.isActive ? \'active\' : \'\'}"><a class="nav-link" href.bind="row.href"><span class="lead"><i class="${row.settings.icon}" aria-hidden="true"></i> ${row.title}</span></a></li></ul></div></nav><!-- --><div class="container mt-5 mb-5"><router-view></router-view></div></template>'})}(),System.register("app.js",["aurelia-framework","aurelia-router","aurelia-event-aggregator","./services/data-service.js"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j;return{setters:[function(a){d=a.inject},function(a){e=a.Router},function(a){f=a.EventAggregator},function(a){g=a.DataService}],execute:function(){a("App",(h=d(e,g,f),j=h(i=function(){function a(b,d,e){c(this,a),this.router=b,this.dataService=d,this.eventAggregator=e}return a.prototype.configureRouter=function(a,b){a.title="Talvo by Dalsass",a.map([{route:"",redirect:"search",nav:!1},{route:"search",name:"search",moduleId:"pages/search",nav:!0,title:"search",settings:{icon:"fa fa-search"}},{route:"favorite",name:"favorite",moduleId:"pages/fav",nav:!0,title:"favourite",settings:{icon:"fa fa-star"}},{route:"register",name:"register",moduleId:"pages/register"},{route:"guest",name:"guest",moduleId:"pages/guest"},{route:"visit",name:"visit",moduleId:"pages/visit"}]),this.router=b},a.prototype.activate=function(){return console.log("app activate"),this.dataService.getData()},a.prototype.attached=function(){$(".navbar-nav>li>a").on("click",function(){$(".navbar-collapse").collapse("hide")}),$(".navbar-collapse").on("show.bs.collapse",function(){$(".navbar").removeClass("nav-bg-hide"),$(".navbar").addClass("nav-bg-show")}),$(".navbar-collapse").on("hide.bs.collapse",function(){$(".navbar").addClass("nav-bg-hide"),$(".navbar").removeClass("nav-bg-show")})},a}())||i)),a("App",j)}}}),System.register("main.js",["bootstrap","bootstrap/dist/css/bootstrap.min.css!css"],function(a,b){"use strict";function c(a){a.use.standardConfiguration().developmentLogging().plugin("oribella-aurelia-gestures"),a.start().then(function(){return a.setRoot("app")})}return a("configure",c),{setters:[function(a){},function(a){}],execute:function(){}}}),function(){var a=System.amdDefine;a("modals/loading.html!github:systemjs/plugin-text@0.0.11.js",[],function(){return'<template><div class="container h-100 w-100" style="opacity: 0.8; background-color: white; position: absolute; top: 0; bottom: 0; left: 0; right: 0; z-index: inherit"><div class="row"><div class="col-12 text-center mt-5"><i class="fa fa-spinner fa-spin" style="font-size:60px"></i></div></div></div></template>'})}(),function(){var a=System.amdDefine;a("modals/remove-all-fav-confirm.html!github:systemjs/plugin-text@0.0.11.js",[],function(){return'<template bindable="remove"><div class="modal fade" id="removeAllFavConfirmModal" tabindex="-1" role="dialog" aria-hidden="true"><div class="modal-dialog" role="document"><div class="modal-content"><!-- Header --><div class="modal-header"><h5 class="modal-title">Delete confirmation</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><!-- Body --><div class="modal-body"><p>Are you sure you would like clear the favorite list?</p></div><!-- Footer --><div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">No</button> <button type="button" class="btn btn-primary" oa-tap.call="remove()">Yes</button></div><require from="./loading.html"></require><loading show.bind="loading"></loading></div></div></div></template>'})}(),function(){var a=System.amdDefine;a("modals/remove-single-fav-confirm.html!github:systemjs/plugin-text@0.0.11.js",[],function(){return'<template bindable="name, remove"><div class="modal fade" id="removeSingleFavConfirmModal" tabindex="-1" role="dialog" aria-hidden="true"><div class="modal-dialog" role="document"><div class="modal-content"><!-- Header --><div class="modal-header"><h5 class="modal-title">Delete confirmation</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><!-- Body --><div class="modal-body"><p>Are you sure you would like to remove <span class="font-weight-bold">${name} </span>from favorites?</p></div><!-- Footer --><div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">No</button> <button type="button" class="btn btn-primary" oa-tap.call="remove()">Yes</button></div><!--<require from="./loading.html"></require>\n\t\t\t\t<loading show.bind="loading"></loading>\n\t\t\t\t--></div></div></div></template>'})}(),function(){var a=System.amdDefine;a("modals/result-delete-confirm.html!github:systemjs/plugin-text@0.0.11.js",[],function(){return'<template bindable="name, delete, loading"><div class="modal fade" id="resultDeleteConfirmModal" tabindex="-1" role="dialog" aria-hidden="true"><div class="modal-dialog" role="document"><div class="modal-content"><!-- Header --><div class="modal-header"><h5 class="modal-title">Delete confirmation</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><!-- Body --><div class="modal-body"><p>Are you sure you would like to delete the regisiter: ${name}</p></div><!-- Footer --><div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">No</button> <button type="button" class="btn btn-primary" oa-tap.call="delete()">Yes</button></div><require from="./loading.html"></require><loading show.bind="loading"></loading></div></div></div></template>'})}(),function(){var a=System.amdDefine;a("pages/fav.html!github:systemjs/plugin-text@0.0.11.js",[],function(){return'<template><div class="row mb-3"><div class="col-12"><div class="lead text-right w-100"><i class="fa fa-print pl-2 ml-2" aria-hidden="true" oa-tap.call="print()"></i> <i if.bind="!allShown" class="fa fa-eye pl-2 ml-2" aria-hidden="true" oa-tap.call="showAll()"></i> <i if.bind="allShown" class="fa fa-eye-slash pl-2 ml-2" aria-hidden="true" oa-tap.call="hideAll()"></i> <i class="fa fa-star pl-2 ml-2" oa-tap.call="confirmRemoveAll()"></i></div></div></div><!-- results --><div class="row custom-bg-color-1 custom-border-radius-1 pt-3 pb-3 noselect" show.bind="results.length > 0"><!-- Wrap in a container to make it scrollable --><div class="col-12"><div repeat.for="result of results" class="mt-2 pt-2"><div class="row lead pb-2"><!-- tap listener here --><div class="col-8" oa-tap.call="select($event, result._id)"><i class="fa fa-users" aria-hidden="true"></i> <span class="ml-2">${result.name}</span></div><!-- 2x tap listener in child --><div class="col-4 text-right"><!-- tap listener here --> <span><i if.bind="collapsed[result._id]" class="fa fa-eye pr-2 pl-2" aria-hidden="true" oa-tap.call="toggleSingle($event, result)"></i> <i if.bind="!collapsed[result._id]" class="fa fa-eye-slash pr-2 pl-2" aria-hidden="true" oa-tap.call="toggleSingle($event, result)"></i> </span><!-- tap listener here --> <span><i class="fa fa-star pr-2 pl-2 ${result.fav ? \'favorite\' : \'\'}" aria-hidden="true" oa-tap.call="confirmRemoveSingle($event, result)"></i></span></div></div><div class="row collapse" id="${result._id}-collapse" style="background-color: white; border: 1px solid #e9ecef"><!-- More info guests row --><div class="col-12 pb-2"><div class="register-guest mt-3" repeat.for="guest of getRegisterGuests(result)"><!-- R1 --><div class="row mb-1"><div class="col-12 font-weight-bold"><i class="fa fa-user" aria-hidden="true"></i> ${guest.firstname} ${guest.lastname} (${guest.fam})</div></div><!-- R2 --><div class="row mb-1"><div class="col-6 col-sm-4"><div class="guest-lables">Wasser</div><div>${guest.water}</div></div><div class="col-6 col-sm-8"><div class="guest-lables">Sprache(n)</div><div>${guest.languages.join(\'/\')}</div></div></div><!-- R3 --><div class="row mb-1" if.bind="guest.dates.length > 0"><div class="col-12"><div class="guest-lables">Special dates</div><div><div repeat.for="date of guest.dates">${date.what} - ${dateHelper.formatCustomDate(date.when)}</div></div></div></div><!-- R4 --><div class="row mb-1" if.bind="guest.allergies.length > 0"><div class="col-12"><div class="guest-lables">Allergien</div><div>${guest.allergies.join(\', \')}</div></div></div><!-- R5 --><div class="row mb-1" if.bind="guest.notes.length > 1"><div class="col-12"><div class="guest-lables">Notizen</div><div>${guest.notes}</div></div></div></div></div><!-- More info visits row --><div class="col-12 pb-2"><div class="row"><div class="col-4 guest-lables">Datum</div><div class="col-4 guest-lables">Weine</div><div class="col-4 guest-lables">Notizen</div></div><div class="register-visit mt-2" repeat.for="visit of getRegisterVisits(result)"><div class="row pt-2 pb-2"><div class="col-4">${dateHelper.formatDate(visit.date)}</div><div class="col-4">${visit.wines.join(\'\\n\')}</div><div class="col-4">${visit.notes}</div></div></div></div></div></div></div></div><div class="row custom-bg-color-1 custom-border-radius-1 pt-3 pb-3 noselect" show.bind="results.length === 0"><div class="col-12 result-container mt-2"><p class="lead text-center">Nothing here yet</p></div></div><require from="../modals/remove-all-fav-confirm.html"></require><require from="../modals/remove-single-fav-confirm.html"></require><remove-all-fav-confirm remove.call="removeAll()"></remove-all-fav-confirm><remove-single-fav-confirm name.bind="resultToRemove.name" remove.call="removeSingle(resultToRemove._id)"></remove-single-fav-confirm></template>'})}(),System.register("pages/fav.js",["aurelia-framework","aurelia-router","jquery","../helpers/date.js","../services/data-service.js"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j,k;return{setters:[function(a){d=a.inject},function(a){e=a.Router},function(a){f=a.default},function(a){g=a.DateHelper},function(a){h=a.DataService}],execute:function(){a("default",(i=d(e,g,h),k=i(j=function(){function a(b,d,e){c(this,a),this.router=b,this.dateHelper=d,this.dataService=e,this.results=[],this.collapsed={},this.allShown=!1}return a.prototype.attached=function(){this.setup(),this.removeAllFavConfirmModal=f("#removeAllFavConfirmModal"),this.removeSingleFavConfirmModal=f("#removeSingleFavConfirmModal")},a.prototype.setup=function(){this.results=this.dataService.getFavoriteRegisters();for(var a=this.results,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;this.collapsed[e._id]=!0}},a.prototype.select=function(a,b){this.router.navigateToRoute("register",{r_id:b})},a.prototype.getRegisterGuests=function(a){return this.dataService.getGuestsById(a.guests)},a.prototype.getRegisterVisits=function(a){return this.dataService.getVisitsById(a.visits)},a.prototype.toggleSingle=function(a,b){f("#"+b._id+"-collapse").collapse("toggle"),this.collapsed[b._id]=!this.collapsed[b._id]},a.prototype.confirmRemoveSingle=function(a,b){this.removeSingleFavConfirmModal.modal("show"),this.resultToRemove=b},a.prototype.confirmRemoveAll=function(){this.removeAllFavConfirmModal.modal("show")},a.prototype.removeSingle=function(a){this.dataService.removeRegisterFromFav(a),this.removeSingleFavConfirmModal.modal("hide"),this.resultToRemove=null,this.setup()},a.prototype.removeAll=function(){for(var a=this.results,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;this.dataService.removeRegisterFromFav(e._id)}this.removeAllFavConfirmModal.modal("hide"),this.setup()},a.prototype.showAll=function(){for(var a=Object.entries(this.collapsed),b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d,g=e[0];e[1];f("#"+g+"-collapse").collapse("show"),this.collapsed[g]=!1}this.allShown=!0},a.prototype.hideAll=function(){for(var a=Object.entries(this.collapsed),b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d,g=e[0];e[1];f("#"+g+"-collapse").collapse("hide"),this.collapsed[g]=!0}this.allShown=!1},a.prototype.print=function(){window.print()},a}())||j)),a("default",k)}}}),function(){var a=System.amdDefine;a("pages/guest.html!github:systemjs/plugin-text@0.0.11.js",[],function(){return'<template><!-- Row 1 (FAM) --><div class="row"><div class="col-6"><div class="form-group"><label for="guest-input-fam">Fam.</label><input class="form-control" type="text" list="guest-input-fam" value.bind="tempGuest.fam"><datalist id="guest-input-fam"><option repeat.for="item of inputHelper.getFamInputs()">${item}</option></datalist></div></div></div><!-- Row 2 (First + Second name) --><div class="row"><div class="col-6"><div class="form-group"><label for="guest-input-name">Vorname</label><input type="text" class="form-control" id="guest-input-name" value.bind="tempGuest.firstname"></div></div><div class="col-6"><div class="form-group"><label for="guest-input-surname">Nachname</label><input type="text" class="form-control" id="guest-input-surname" value.bind="tempGuest.lastname"></div></div></div><!-- Row 3 (Water) --><div class="row"><div class="col-6"><div class="form-group"><label for="guest_input_wasser">Wasser</label><input class="form-control" type="text" list="guest-input-water" value.bind="tempGuest.water"><datalist id="guest-input-water"><option repeat.for="item of inputHelper.getWaterInputs()">${item}</option></datalist></div></div></div><!-- Row 4 (Sprache) --><div class="row"><div class="col-12"><div class="form-group"><label for="guest_input_wasser">Sprache</label><!-- Prefill from tempGuest.languages--><div class="row mb-2" repeat.for="lang of tempGuest.languages"><div class="col-6"><div class="input-group"><input class="form-control" type="text" list="guest-input-lang" value="${lang}" readonly="readonly"><div class="input-group-append"><button class="btn btn-danger" type="button" oa-tap.call="removeLanguage($index)"><i class="fa fa-minus" aria-hidden="true"></i></button></div></div></div></div><div class="row"><div class="col-6"><div class="input-group"><input class="form-control" type="text" list="guest-input-lang" value.bind="tempLanguage"><datalist id="guest-input-lang"><option repeat.for="item of inputHelper.getLanguageInputs()">${item}</option></datalist><div class="input-group-append"><button class="btn btn-success" id="add-language-button" type="button" oa-tap.call="addLanguage()"><i class="fa fa-plus" aria-hidden="true"></i></button></div></div></div></div></div></div></div><!-- Row 5 (Allergies) --><div class="row"><div class="col-12"><div class="form-group"><label for="guest_input_allergie">Allergie/Intoleranz</label><!-- Prefill from array--><div class="row mb-2" repeat.for="allergy of tempGuest.allergies"><div class="col-12"><div class="input-group"><input class="form-control" type="text" list="guest-input-allergy" value="${allergy}" readonly="readonly"><div class="input-group-append"><button class="btn btn-danger" type="button" oa-tap.call="removeAllergy($index)"><i class="fa fa-minus" aria-hidden="true"></i></button></div></div></div></div><!-- Empty --><div class="row"><div class="col-12"><div class="input-group"><input class="form-control" type="text" list="guest-input-allergy" value.bind="tempAllergy"><datalist id="guest-input-allergy"><option repeat.for="item of inputHelper.getAllergyInputs()">${item}</option></datalist><div class="input-group-append"><button class="btn btn-success" id="add-allergy-button" type="button" oa-tap.call="addAllergy()"><i class="fa fa-plus" aria-hidden="true"></i></button></div></div></div></div></div></div></div><!-- Row 6 (Special dates) --><div class="row"><div class="col-12"><div class="form-group"><label for="guest_input_allergie">Besondere Tage</label><!-- Prefill --><div class="row mb-2" repeat.for="date of tempGuest.dates"><div class="col-4"><input class="form-control" type="text" list="guest-input-dates" placeholder="beschreibung" value="${date.what}" readonly="readonly"></div><div class="col-8"><div class="input-group"><input type="text" class="form-control" placeholder="day" value="${date.when.day}" readonly="readonly"> <input type="text" class="form-control" placeholder="month" value="${date.when.month}" readonly="readonly"> <input type="text" class="form-control" placeholder="year" value="${date.when.year}" readonly="readonly"><div class="input-group-append"><button class="btn btn-danger" type="button" oa-tap.call="removeDate($index)"><i class="fa fa-minus" aria-hidden="true"></i></button></div></div></div></div><!-- Empty --><div class="row"><div class="col-4"><input class="form-control" type="text" list="guest-input-dates" placeholder="beschreibung" value.bind="tempDate.what"><datalist id="guest-input-dates"><option repeat.for="item of inputHelper.getSpecialDatesInput()">${item}</option></datalist></div><div class="col-8"><div class="input-group"><input type="text" class="form-control" placeholder="day" value.bind="tempDate.when.day"> <input type="text" class="form-control" placeholder="month" value.bind="tempDate.when.month"> <input type="text" class="form-control" placeholder="year" value.bind="tempDate.when.year"><div class="input-group-append"><button class="btn btn-success" id="add-date-button" type="button" oa-tap.call="addDate()"><i class="fa fa-plus" aria-hidden="true"></i></button></div></div></div></div></div></div></div><!-- Row 7 (Notes) --><div class="row"><div class="col-12"><div class="form-group"><label for="guest-input-notes">Notes</label><textarea id="guest-input-notes" class="form-control" value.bind="tempGuest.notes" rows="8"></textarea></div></div></div><!-- Row 8 (Buttons) --><div class="row"><div class="col-12 text-right"><button click.delegate="delete()" type="button" class="btn btn-danger btn-lg" if.bind="tempGuest._id">Delete</button> <button click.delegate="reset()" type="button" class="btn btn-secondary btn-lg">Reset</button> <button click.delegate="save()" type="button" class="btn btn-success btn-lg">Save</button> <button click.delegate="cancel()" type="button" class="btn btn-warning btn-lg">Cancel</button></div></div></template>'})}(),System.register("helpers/inputs.js",[],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d;return{setters:[],execute:function(){a("InputHelper",d=function(){function a(){c(this,a),this.fam=["ER","SIE","Tochter","Sohn"],this.water=["Ohne","Mit NK","Ohne NK","Hahnenwasser"],this.allergy=["Vegetarier","Veg. Kein Fleisch","Veg. Kein Fisch","Vegan","Glutenfrei","Laktosefrei","Diabetiker"],this.languages=["DE","IT","EN","FR","ES"],this.specialDates=["Geburtstag","Hochzeitstag","Namenstag"]}return a.prototype.getFamInputs=function(){return this.fam},a.prototype.getWaterInputs=function(){return this.water},a.prototype.getAllergyInputs=function(){return this.allergy},a.prototype.getLanguageInputs=function(){return this.languages},a.prototype.getSpecialDatesInput=function(){return this.specialDates},a}()),a("InputHelper",d)}}}),System.register("pages/guest.js",["aurelia-framework","aurelia-router","jquery","../helpers/inputs.js","../services/data-service.js"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j,k,l;return{setters:[function(a){d=a.inject,e=a.BindingEngine},function(a){f=a.Router},function(a){g=a.default},function(a){h=a.InputHelper},function(a){i=a.DataService}],execute:function(){a("default",(j=d(f,i,h,e),l=j(k=function(){function a(b,d,e,f){var g=this;c(this,a),this.router=b,this.dataService=d,this.inputHelper=e,this.bindingEngine=f,this.subscriptions=[],this.tempGuest=this.createTempGuest(),this.tempLanguage="",this.tempAllergy="",this.tempDate={what:"",when:{day:"",month:"",year:""}};var h=this.bindingEngine.propertyObserver(this,"tempLanguage").subscribe(function(a,b){g.languageInputChange(a,b)}),i=this.bindingEngine.propertyObserver(this,"tempAllergy").subscribe(function(a,b){g.allergyInputChange(a,b)}),j=this.bindingEngine.propertyObserver(this.tempDate,"what").subscribe(function(a,b){g.dateInputChange(a,b)}),k=this.bindingEngine.propertyObserver(this.tempDate.when,"day").subscribe(function(a,b){g.dateInputChange(a,b)}),l=this.bindingEngine.propertyObserver(this.tempDate.when,"month").subscribe(function(a,b){g.dateInputChange(a,b)}),m=this.bindingEngine.propertyObserver(this.tempDate.when,"year").subscribe(function(a,b){g.dateInputChange(a,b)});this.subscriptions.push(h),this.subscriptions.push(i),this.subscriptions.push(j),this.subscriptions.push(k),this.subscriptions.push(l),this.subscriptions.push(m)}return a.prototype.createTempGuest=function(){var a={fam:"",firstname:"",lastname:"",water:"",allergies:[],languages:[],dates:[],notes:""};return a},a.prototype.activate=function(a,b,c){this.r_id=a.r_id,this.g_id=a.g_id,this.reset()},a.prototype.attached=function(){g("#add-language-button").prop("disabled",!0),g("#add-allergy-button").prop("disabled",!0),g("#add-date-button").prop("disabled",!0)},a.prototype.detached=function(){for(var a=this.subscriptions,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;e.dispose()}},a.prototype.removeLanguage=function(a){this.tempGuest.languages.splice(a,1)},a.prototype.addLanguage=function(){g("#add-language-button").prop("disabled")||(this.tempGuest.languages.push(this.tempLanguage),this.tempLanguage="")},a.prototype.languageInputChange=function(a,b){0===a.trim().length?g("#add-language-button").prop("disabled",!0):g("#add-language-button").prop("disabled",!1)},a.prototype.removeAllergy=function(a){this.tempGuest.allergies.splice(a,1)},a.prototype.addAllergy=function(){g("#add-allergy-button").prop("disabled")||(this.tempGuest.allergies.push(this.tempAllergy),this.tempAllergy="")},a.prototype.allergyInputChange=function(a,b){0===a.trim().length?g("#add-allergy-button").prop("disabled",!0):g("#add-allergy-button").prop("disabled",!1)},a.prototype.removeDate=function(a){this.tempGuest.dates.splice(a,1)},a.prototype.addDate=function(){g("#add-date-button").prop("disabled")||(console.log(this.tempGuest.dates),this.tempGuest.dates.push(JSON.parse(JSON.stringify(this.tempDate))),this.tempDate.what="",this.tempDate.when.day="",this.tempDate.when.month="",this.tempDate.when.year="")},a.prototype.dateInputChange=function(a,b){0===this.tempDate.what.trim().length||0===this.tempDate.when.day.trim().length||0===this.tempDate.when.month.trim().length?g("#add-date-button").prop("disabled",!0):g("#add-date-button").prop("disabled",!1)},a.prototype.reset=function(){this.g_id?this.tempGuest=this.dataService.getGuestById(this.g_id):this.tempGuest=this.createTempGuest()},a.prototype.cancel=function(){this.router.navigateToRoute("register",{r_id:this.r_id})},a.prototype.save=function(){var a=this;this.g_id?(this.dataService.updateGuest(this.tempGuest),this.cancel()):this.dataService.addGuest(this.tempGuest).then(function(b){a.dataService.addGuestToRegister(b,a.r_id),a.cancel()})},a}())||k)),a("default",l)}}}),function(){var a=System.amdDefine;a("pages/print.html!github:systemjs/plugin-text@0.0.11.js",[],function(){return'<template><style type="text/css">div {\n\t\t\tfont-size: 14px;\n\t\t}\n\n\t\t.guest-lables {\n            font-size: 10pt;\n            opacity: 0.5;\n        }\n\n        .space-end-row-1 {\n            padding-bottom: 10px;\n        }\n\n        .guest-border-bottom {\n        \tborder-bottom: 1px solid #333333;\n            margin-bottom: 15px;\n        }\n\n        .register-info {\n        \tbackground-color: #f5f5f5;\n        \tmargin-bottom: 10px;\n        \tpage-break-after : always;\n        }\n\n        .margin-top-reset {\n        \tmargin-top: 0px;\n        }</style><div class="row no-print"><div class="col-xs-10"></div><div class="col-xs-1"><h2 class="pull-right margin-top-reset" click.delegate="print_all_info()"><i class="fa fa-print"></i></h2></div><div class="col-xs-1"><h2 class="pull-right margin-top-reset" click.delegate="show_all_info()"><i class="fa fa-eye ${ collapsed_all ? \'fa-eye-slash\' : \'fa-eye\' }"></i></h2></div></div><div class="row register-info ${ register.collapsed ? \'no-print\' : \'\' }" repeat.for="register of registers"><div class="col-xs-12"><div class="row" click.delegate="show_info(register._id)"><div class="col-xs-4"><h4><i style="margin-right: 10px" class="fa fa-users fa-fw" aria-hidden="true"></i> ${register.name}</h4></div><div class="col-xs-offset-6 col-xs-2"><h4 class="pull-right"><i class="fa fa-eye ${ register.collapsed ? \'fa-eye\' : \'fa-eye-slash\' }"></i></h4></div></div><!-- Colapse here? --><div class="row"><div class="col-xs-1"></div><div class="col-xs-11"><div class="collapse" id="collapse-${register._id}"><div class="row"><div class="col-xs-12"><h5>Gäste</h5></div></div><!-- GUESTS --><div class="row" repeat.for="guest of register.guests2"><div class="col-xs-12"><!-- Info 1 --><div class="row space-end-row-1"><!-- Fam --><div class="col-xs-2"><div class="row"><div class="col-xs-12 guest-lables">Fam.</div></div><div class="row"><div class="col-xs-12">${guest.fam}</div></div></div><!-- Name --><div class="col-xs-6"><div class="row"><div class="col-xs-12 guest-lables">Name</div></div><div class="row"><div class="col-xs-12">${guest.firstname} ${guest.lastname}</div></div></div><!-- Wasser --><div class="col-xs-4"><div class="row"><div class="col-xs-12 guest-lables">Wasser</div></div><div class="row"><div class="col-xs-12">${guest.water}</div></div></div></div><!-- Info 2 --><div class="row space-end-row-1"><!-- Sprache --><div class="col-xs-2"><div class="row"><div class="col-xs-12 guest-lables">Sprache</div></div><div class="row"><div class="col-xs-12" if.bind="guest.languages.length >= 1">${guest.languages.join(\'/\')}</div><div class="col-xs-12" if.bind="guest.languages.length === 0">--</div></div></div><!-- Special dates --><div class="col-xs-6"><div class="row"><div class="col-xs-12 guest-lables">Special dates</div></div><div class="row"><div class="col-xs-12" repeat.for="date of guest.dates" if.bind="guest.dates.length >= 1">${date.what} - ${format_date(date.when)}</div><div class="col-xs-12" if.bind="guest.dates.length === 0">--</div></div></div><!-- Allergien --><div class="col-xs-4"><div class="row"><div class="col-xs-12 guest-lables">Allergien</div></div><div class="row"><div class="col-xs-12" repeat.for="al of guest.allergies" if.bind="guest.allergies.length >= 1">${al}</div><div class="col-xs-12" if.bind="guest.allergies.length === 0">--</div></div></div></div><!-- Info 3 --><div class="row space-end-row-1"><div class="col-md-12"><div class="row"><div class="col-xs-12 guest-lables">Notizen</div></div><div class="row"><div class="col-xs-12" if.bind="guest.notes.length >= 1">${guest.notes}</div><div class="col-xs-12" if.bind="guest.notes.length === 0">--</div></div></div></div><div class="${ !$last ? \'guest-border-bottom\' : \'\' }"></div></div></div><div class="row"><div class="col-xs-12"><h5>Besuche</h5></div></div><!-- VISITS --><div class="row" repeat.for="visit of register.visits2"><div class="col-xs-12"><div class="row"><div class="col-xs-2">${format_date_2(visit.date)}</div><div class="col-xs-4" style="white-space: pre-line">${visit.wines.join(\'\\n\')}</div><div class="col-xs-6"><div if.bind="visit.notes.length >= 1">${visit.notes}</div><div if.bind="visit.notes.length === 0">--</div></div></div><div class="${ !$last ? \'guest-border-bottom\' : \'\' }"></div></div></div></div></div></div></div></div></template>'})}(),System.register("pages/print.js",["aurelia-framework","aurelia-router","jquery","./db-service.js"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j;return{setters:[function(a){d=a.inject},function(a){e=a.Router},function(a){f=a.default},function(a){g=a.DatabaseService}],execute:function(){a("Print",(h=d(e,g),j=h(i=function(){function a(b,d){c(this,a),this.router=b,this.db_service=d,this.registers=[],this.collapsed_all=!1}return a.prototype.activate=function(){var a=this;return this.db_service.get_fav_list().then(function(b){a.registers=a.sort_reg_by_name(b)})},a.prototype.attached=function(){for(var a=this,b=function(){if(d){if(e>=c.length)return"break";f=c[e++]}else{if(e=c.next(),e.done)return"break";f=e.value}var b=f;b.collapsed=!0;a.db_service.get_guests(b.guests).then(function(a){b.guests2=a}),a.db_service.get_visits(b.visits).then(function(a){b.visits2=a})},c=this.registers,d=Array.isArray(c),e=0,c=d?c:c[Symbol.iterator]();;){var f,g=b();if("break"===g)break}},a.prototype.show_info=function(a){f("#collapse-"+a).collapse("toggle");var b=this.registers.find(function(b){return b._id===a});b.collapsed=!b.collapsed,console.log(b)},a.prototype.show_all_info=function(){this.collapsed_all=!this.collapsed_all;for(var a=this.registers,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;this.collapsed_all===!0?(f("#collapse-"+e._id).collapse("show"),e.collapsed=!1):(f("#collapse-"+e._id).collapse("hide"),e.collapsed=!0)}},a.prototype.print_all_info=function(){window.print()},a.prototype.sort_reg_by_name=function(a){var b=a.sort(function(a,b){var c=a.name.toUpperCase(),d=b.name.toUpperCase();return c<d?-1:c>d?1:0});return b},a.prototype.format_date=function(a){var b=a.day,c=a.month,d=a.year,e=new Date(d+"/"+c+"/"+b).toLocaleDateString();return 0===d.length?e.slice(0,5):e},a.prototype.format_date_2=function(a){var b=new Date(a).toLocaleDateString();return b},a}())||i)),a("Print",j)}}}),function(){var a=System.amdDefine;a("pages/register.html!github:systemjs/plugin-text@0.0.11.js",[],function(){return'<template><!-- Resigter Name row --><div class="row mb-3 pt-2 pb-1 custom-bg-color-1 custom-border-radius-1"><div class="col-8"><h3><!--<i class="fa fa-users" aria-hidden="true"></i>--><!-- <span class="ml-2"> --> ${register.name}<!-- </span> ---></h3></div><div class="col-4 text-right"><h3><i class="fa fa-print mr-2" aria-hidden="true" oa-tap.call="print()"></i> <i class="fa fa-star ${register.fav ? \'favorite\' : \'\'}" aria-hidden="true" oa-tap.call="favorite($event)"></i></h3></div></div><!-- Guests --><div class="row mb-3 pb-2 custom-border-radius-1 custom-border-colour-1"><div class="col-12"><div class="row pt-1 pb-1 custom-bg-color-1"><div class="col-10"><span class="lead font-weight-bold">Gäste (${guests.length})</span></div><div class="col-2 text-right"><span class="lead font-weight-bold"><i class="fa fa-plus" aria-hidden="true" oa-tap.call="addGuest()"></i></span></div></div><div class="row"><div class="col-12"><div class="register-guest mt-3" repeat.for="guest of guests"><!-- R1 --><div class="row mb-1"><div class="col-10 font-weight-bold"><i class="fa fa-user" aria-hidden="true" oa-tap.call="editGuest(guest._id)"></i> ${guest.firstname} ${guest.lastname} (${guest.fam})</div><div class="col-2 text-right"><i class="fa fa-minus" aria-hidden="true" oa-tap.call="removeGuestFromRegister($event, guest._id)"></i></div></div><!-- R2 --><div class="row mb-1"><div class="col-6 col-sm-4"><div class="guest-lables">Wasser</div><div>${guest.water}</div></div><div class="col-6 col-sm-8"><div class="guest-lables">Sprache(n)</div><div>${guest.languages.join(\'/\')}</div></div></div><!-- R3 --><div class="row mb-1" if.bind="guest.dates.length > 0"><div class="col-12"><div class="guest-lables">Special dates</div><div><div repeat.for="date of guest.dates">${date.what} - ${dateHelper.formatCustomDate(date.when)}</div></div></div></div><!-- R4 --><div class="row mb-1" if.bind="guest.allergies.length > 0"><div class="col-12"><div class="guest-lables">Allergien</div><div>${guest.allergies.join(\', \')}</div></div></div><!-- R5 --><div class="row mb-1" if.bind="guest.notes.length > 1"><div class="col-12"><div class="guest-lables">Notizen</div><div>${guest.notes}</div></div></div></div></div></div></div></div><!-- Visits --><div class="row mb-5 pb-2 custom-border-radius-1 custom-border-colour-1"><div class="col-12"><div class="row mb-1 pt-1 pb-1 custom-bg-color-1"><div class="col-10"><span class="lead font-weight-bold">Besuche (${visits.length})</span></div><div class="col-2 text-right"><span class="lead font-weight-bold"><i class="fa fa-plus" aria-hidden="true" oa-tap.call="addVisit()"></i></span></div></div><div class="row"><div class="col-12"><div class="row"><div class="col-4 guest-lables">Datum</div><div class="col-4 guest-lables">Weine</div><div class="col-4 guest-lables">Notizen</div></div><div class="register-visit mt-2" repeat.for="visit of visits"><div class="row pt-2 pb-2"><div class="col-4" oa-tap.call="editVisit(visit._id)">${dateHelper.formatDate(visit.date)}</div><div class="col-3" oa-tap.call="editVisit(visit._id)">${visit.wines.join(\'\\n\')}</div><div class="col-4">${visit.notes}</div><div class="col-1 text-right"><i class="fa fa-minus" aria-hidden="true" oa-tap.call="removeVisit($event, visit._id)"></i></div></div></div></div></div></div></div></template>';
})}(),System.register("helpers/date.js",[],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d;return{setters:[],execute:function(){a("DateHelper",d=function(){function a(){c(this,a)}return a.prototype.formatDate=function(a){var b=new Date(a).toLocaleDateString();return b},a.prototype.formatCustomDate=function(a){var b=a.day,c=a.month,d=a.year,e=new Date(d+"/"+c+"/"+b).toLocaleDateString();return 0===d.length?e.slice(0,5):e},a}()),a("DateHelper",d)}}}),System.register("pages/register.js",["aurelia-framework","aurelia-router","../services/data-service.js","../helpers/date.js"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j,k;return{setters:[function(a){d=a.inject},function(a){e=a.Router,f=a.activationStrategy},function(a){g=a.DataService},function(a){h=a.DateHelper}],execute:function(){a("default",(i=d(e,g),k=i(j=function(){function a(b,d,e){c(this,a),this.router=b,this.dataService=d,this.dateHelper=e,this.register=null,this.guests=null,this.visits=null}return a.prototype.activate=function(a,b,c){this.r_id=a.r_id,this.reset(this.r_id)},a.prototype.reset=function(a){this.register=this.dataService.getRegisterById(a),this.guests=this.dataService.getGuestsById(this.register.guests),this.visits=this.dataService.getVisitsById(this.register.visits)},a.prototype.favorite=function(a){this.register.fav?this.dataService.removeRegisterFromFav(this.register._id):this.dataService.addRegisterToFav(this.register._id)},a.prototype.print=function(){window.print()},a.prototype.addGuest=function(){this.router.navigateToRoute("guest",{r_id:this.register._id})},a.prototype.editGuest=function(a){console.log("edit guest - "+a),this.router.navigateToRoute("guest",{r_id:this.register._id,g_id:a})},a.prototype.removeGuestFromRegister=function(a,b){console.log("removing guest from register"),this.dataService.removeGuestFromRegister(b,this.r_id),this.reset(this.r_id)},a.prototype.addVisit=function(){this.router.navigateToRoute("visit",{r_id:this.register._id})},a.prototype.editVisit=function(a){console.log("editing visit - "+a),this.router.navigateToRoute("visit",{r_id:this.register._id,v_id:a})},a.prototype.removeVisit=function(a,b){console.log("removing guest from register"),this.dataService.removeVisitFromRegister(b,this.r_id),this.reset(this.r_id)},a}())||j)),a("default",k)}}}),function(){var a=System.amdDefine;a("pages/search.html!github:systemjs/plugin-text@0.0.11.js",[],function(){return'<template><!-- Input box --><div class="row custom-bg-color-1 custom-border-radius-1 pt-3 pb-3 mb-3"><div class="col-12"><div class="input-group input-group-lg"><input type="text" class="form-control" placeholder="Please enter your search term" input.delegate="search($event.target.value)" value.bind="searchInputValue"><div class="input-group-append"><button class="btn ${addBtnClass}" type="button" click.trigger="add(searchInputValue)" disabled.bind="addBtnDisabled"><h3 class="mb-0"><i class="fa fa-plus pr-3 pl-3" aria-hidden="true" show.bind="!addBtnLoading"></i> <i class="fa fa-spinner fa-spin pr-3 pl-3" aria-hidden="true" show.bind="addBtnLoading"></i></h3></button></div></div></div></div><!-- Search results --><div class="row custom-bg-color-1 custom-border-radius-1 pt-3 pb-3 noselect" show.bind="results.length > 0"><!-- Wrap in a container to make it scrollable --><div class="col-12 result-container"><div repeat.for="result of results"><div class="row mt-2 mb-2 pt-2 pb-2 lead"><!-- tap listener here --><div class="col-8" oa-tap.call="select($event, result._id)"><i class="fa fa-${result.type === \'register\' ? \'users\' : \'user\'}" aria-hidden="true"></i> <span class="ml-2">${result.name}</span></div><!-- 2x tap listener in child --><div class="col-4 text-right"><!-- tap listener here --> <span><i class="fa fa-star pr-2 pl-2 ${result.fav ? \'favorite\' : \'\'}" aria-hidden="true" oa-tap.call="favorite($event, result)"></i> </span><!-- tap listener here --> <span><i class="fa fa-minus pr-2 pl-2" aria-hidden="true" oa-tap.call="confirmDelete($event, result)"></i></span></div><!--\n                    <div class="d-none d-lg-block col-lg-1 text-right">\n                        <i class="fa fa-minus pr-3 pl-3 ${result.fav ? \'favorite\' : \'\'}" aria-hidden="true" oa-tap.call="delete($event, result)"></i>\n                    </div>\n                    --></div></div></div></div><div class="row custom-bg-color-1 custom-border-radius-1 pt-3 pb-3 noselect" show.bind="results.length === 0"><div class="col-12 result-container mt-2"><p class="lead text-center">No results</p></div></div><require from="../modals/result-delete-confirm.html"></require><result-delete-confirm name.bind="toDelete.name" delete.call="delete()" loading.bind="deleteLoading"></result-delete-confirm></template>'})}(),System.register("pages/search.js",["aurelia-framework","aurelia-router","aurelia-event-aggregator","../services/data-service.js","jquery"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j,k;return{setters:[function(a){d=a.inject},function(a){e=a.Router},function(a){f=a.EventAggregator},function(a){g=a.DataService},function(a){h=a.default}],execute:function(){a("default",(i=d(e,g,f),k=i(j=function(){function a(b,d,e){c(this,a),this.router=b,this.dataService=d,this.eventAggregator=e,this.subscriptions=[],this.searching=!1,this.results=[],this.addBtnDisabled=!0,this.addBtnClass="btn-outline-secondary",this.addBtnLoading=!1,this.deleteLoading=!1,this.searchInputValue=""}return a.prototype.attached=function(){this.search(""),this.resultDeleteConfirmModal=h("#resultDeleteConfirmModal")},a.prototype.detached=function(){for(var a=this.subscriptions,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;e.dispose()}},a.prototype.search=function(a){this.addBtnClass="btn-outline-secondary",this.addBtnDisabled=!0,a.length>0&&(this.addBtnDisabled=!1,this.addBtnClass="btn-outline-success"),this.results=this.dataService.search(a)},a.prototype.select=function(a,b){this.router.navigateToRoute("register",{r_id:b})},a.prototype.add=function(a){var b=this;this.addBtnLoading=!0,this.addBtnDisabled=!0,this.dataService.addRegister(a).then(function(){b.addBtnLoading=!1,b.addBtnDisabled=!1,b.search(a)})},a.prototype.favorite=function(a,b){b.fav?this.dataService.removeRegisterFromFav(b._id):this.dataService.addRegisterToFav(b._id)},a.prototype.confirmDelete=function(a,b){this.resultDeleteConfirmModal.modal("show"),this.toDelete=b},a.prototype.delete=function(){var a=this;console.log("deleting "+this.toDelete),this.deleteLoading=!0,this.dataService.deleteRegister(this.toDelete._id).then(function(){a.search(a.searchInputValue),a.deleteLoading=!1,a.toDelete=null,a.resultDeleteConfirmModal.modal("hide")}).catch(function(b){a.deleteLoading=!1})},a}())||j)),a("default",k)}}}),function(){var a=System.amdDefine;a("pages/visit.html!github:systemjs/plugin-text@0.0.11.js",[],function(){return'<template><!-- Date --><div class="row"><div class="col-6"><div class="form-group"><label for="visit-input-date">Datum</label><input type="date" class="form-control" id="visit-input-date" value.bind="tempVisit.date"></div></div></div><!-- Wines --><div class="row"><div class="col-12"><label for="visit-input-wine">Weine</label><!-- prefill --><div class="row" repeat.for="wine of tempVisit.wines"><div class="col-6"><div class="form-group"><div class="input-group"><input type="text" class="form-control" value="${wine}" disabled="disabled"><div class="input-group-append"><button class="btn btn-danger" type="button" oa-tap.call="removeWine($index)"><i class="fa fa-minus" aria-hidden="true"></i></button></div></div></div></div></div><!-- empty --><div class="row"><div class="col-6"><div class="form-group"><div class="input-group"><input type="text" class="form-control" value.bind="tempWine"><div class="input-group-append"><button class="btn btn-success" id="add-wine-button" type="button" oa-tap.call="addWine()"><i class="fa fa-plus" aria-hidden="true"></i></button></div></div></div></div></div></div></div><!-- Notes --><div class="row"><div class="col-12"><div class="form-group"><label for="visit-input-notes">Notes</label><textarea type="textarea" class="form-control" id="visit-input-notes" value.bind="tempVisit.notes" rows="4"></textarea></div></div></div><!-- Buttons --><div class="row"><div class="col-12 text-right"><button oa-tap.call="reset()" type="button" class="btn btn-secondary btn-lg">Reset</button> <button oa-tap.call="save()" type="button" class="btn btn-success btn-lg">Save</button> <button oa-tap.call="cancel()" type="button" class="btn btn-warning btn-lg">Cancel</button></div></div></template>'})}(),System.register("services/fetch-service.js",["aurelia-framework","aurelia-fetch-client"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i;return{setters:[function(a){d=a.inject},function(a){e=a.HttpClient,f=a.json}],execute:function(){a("FetchService",(g=d(e),i=g(h=function(){function a(b){c(this,a),console.log("fetch service constructed"),b.configure(function(a){a.withBaseUrl("https://snf-44413.vm.okeanos-global.grnet.gr/").withDefaults({headers:{Accept:"application/json","X-Requested-With":"Fetch"}})}),this.http=b}return a.prototype.get=function(a){return this.http.fetch(a,{method:"GET"}).then(function(a){return a.json()}).then(function(a){return a}).catch(function(a){console.log(a)})},a.prototype.put=function(a,b){return this.http.fetch(a,{method:"PUT",body:f(b)}).then(function(a){return a.json()}).then(function(a){return a}).catch(function(a){console.log(a)})},a.prototype.post=function(a,b){return this.http.fetch(a,{method:"POST",body:f(b)}).then(function(a){return a.json()}).then(function(a){return a}).catch(function(a){console.log(a)})},a.prototype.delete=function(a){return console.log("delete method - fetch service - "+a),this.http.fetch(a,{method:"DELETE"}).then(function(a){return a.json()}).then(function(a){return a}).catch(function(a){console.log(a)})},a}())||h)),a("FetchService",i)}}}),System.register("services/database-service.js",["aurelia-framework","./fetch-service.js"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h;return{setters:[function(a){d=a.inject},function(a){e=a.FetchService}],execute:function(){a("DatabaseService",(f=d(e),h=f(g=function(){function a(b){c(this,a),console.log("db service constructed"),this.fs=b}return a.prototype.getAllRegisters=function(){var a=this;return new Promise(function(b,c){a.fs.get("test/registers").then(function(a){b(a.registers)}).catch(function(a){c(a)})})},a.prototype.addRegister=function(a){var b=this;return new Promise(function(c,d){b.fs.put("test/register",{name:a}).then(function(a){c(a.register)}).catch(function(a){d(a)})})},a.prototype.updateRegister=function(a,b){var c=this;return new Promise(function(d,e){c.fs.post("test/register/"+a,b).then(function(a){d(a.register)}).catch(function(a){e(a)})})},a.prototype.deleteRegister=function(a){var b=this;return new Promise(function(c,d){b.fs.delete("test/register/"+a).then(function(a){c()}).catch(function(a){d(a)})})},a.prototype.getAllGuests=function(){var a=this;return new Promise(function(b,c){a.fs.get("test/guests").then(function(a){b(a.guests)}).catch(function(a){c(a)})})},a.prototype.getGuests=function(a){var b=this;return new Promise(function(c,d){b.fs.post("test/guests",a).then(function(a){c(a.guests)}).catch(function(a){d(a)})})},a.prototype.addGuest=function(a){var b=this;return new Promise(function(c,d){b.fs.put("test/guest",a).then(function(a){c(a.guest)}).catch(function(a){d(a)})})},a.prototype.updateGuest=function(a,b){var c=this;return new Promise(function(d,e){c.fs.post("test/guest/"+a,b).then(function(a){d(a.guest)}).catch(function(a){e(a)})})},a.prototype.getAllVisits=function(){var a=this;return new Promise(function(b,c){a.fs.get("test/visits").then(function(a){b(a.visits)}).catch(function(a){c(a)})})},a.prototype.updateVisit=function(a,b){var c=this;return new Promise(function(d,e){c.fs.post("test/visit/"+a,b).then(function(a){d(a.visit)}).catch(function(a){e(a)})})},a.prototype.addVisit=function(a){var b=this;return new Promise(function(c,d){b.fs.put("test/visit",a).then(function(a){c(a.visit)}).catch(function(a){d(a)})})},a}())||g)),a("DatabaseService",h)}}}),System.register("services/data-service.js",["aurelia-framework","./database-service.js"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h;return{setters:[function(a){d=a.inject},function(a){e=a.DatabaseService}],execute:function(){a("DataService",(f=d(e),h=f(g=function(){function a(b){c(this,a),console.log("DataService constructed"),this.databaseService=b,this.registers=[],this.guests=[],this.visits=[]}return a.prototype.search=function(a){var b=a.toUpperCase(),c=this.registers.filter(function(a){var c=a.name.toUpperCase();if(c.search(b)!==-1)return!0});return c.sort(this.sortEntryByNameAscending)},a.prototype.sortEntryByNameAscending=function(a,b){var c=a.name.toUpperCase(),d=b.name.toUpperCase();return c<d?-1:c>d?1:0},a.prototype.getData=function(){var a=this,b=this.databaseService.getAllRegisters(),c=this.databaseService.getAllGuests(),d=this.databaseService.getAllVisits();return Promise.all([b,c,d]).then(function(b){a.registers=b[0]||[],a.guests=b[1]||[],a.visits=b[2]||[]})},a.prototype.getRegisterById=function(a){var b=this.registers.find(function(b){return b._id===a});return b},a.prototype.getGuestsById=function(a){for(var b=this,c=[],d=function(){if(f){if(g>=e.length)return"break";h=e[g++]}else{if(g=e.next(),g.done)return"break";h=g.value}var a=h,d=b.guests.find(function(b){return b._id===a});c.push(d)},e=a,f=Array.isArray(e),g=0,e=f?e:e[Symbol.iterator]();;){var h,i=d();if("break"===i)break}return c},a.prototype.getGuestById=function(a){var b=this.guests.find(function(b){return b._id===a});return JSON.parse(JSON.stringify(b))},a.prototype.getVisitsById=function(a){for(var b=this,c=[],d=function(){if(f){if(g>=e.length)return"break";h=e[g++]}else{if(g=e.next(),g.done)return"break";h=g.value}var a=h,d=b.visits.find(function(b){return b._id===a});c.push(d)},e=a,f=Array.isArray(e),g=0,e=f?e:e[Symbol.iterator]();;){var h,i=d();if("break"===i)break}return c},a.prototype.getVisitById=function(a){var b=this.visits.find(function(b){return b._id===a});return JSON.parse(JSON.stringify(b))},a.prototype.getFavoriteRegisters=function(){var a=this.registers.filter(function(a){return a.fav===!0});return a},a.prototype.updateGuest=function(a){var b=this.guests.findIndex(function(b){return b._id===a._id});this.guests.splice(b,1),this.guests.push(a),this.databaseService.updateGuest(a._id,a).then(function(){console.log("guest updated successfully")})},a.prototype.updateVisit=function(a){var b=this.visits.findIndex(function(b){return b._id===a._id});this.visits.splice(b,1),this.visits.push(a),this.databaseService.updateVisit(a._id,a).then(function(){console.log("vist updated successfully")})},a.prototype.addRegister=function(a){var b=this,c=new Promise(function(c,d){b.databaseService.addRegister(a).then(function(a){b.registers.push(a),c()})});return c},a.prototype.addRegisterToFav=function(a){var b=this.registers.find(function(b){return b._id===a});b.fav=!0,this.databaseService.updateRegister(a,b)},a.prototype.addGuest=function(a){var b=this,c=new Promise(function(c,d){b.databaseService.addGuest(a).then(function(a){console.log("guest created successfully"),b.guests.push(a),c(a._id)})});return c},a.prototype.addVisit=function(a){var b=this,c=new Promise(function(c,d){b.databaseService.addVisit(a).then(function(a){console.log("visit created successfully"),b.visits.push(a),c(a._id)})});return c},a.prototype.addGuestToRegister=function(a,b){var c=this.registers.find(function(a){return a._id===b});c.guests.push(a),this.databaseService.updateRegister(b,c).then(function(){console.log("guest successfully added to register")})},a.prototype.addVisitToRegister=function(a,b){var c=this.registers.find(function(a){return a._id===b});c.visits.push(a),this.databaseService.updateRegister(b,c).then(function(){console.log("visit successfully added to register")})},a.prototype.deleteRegister=function(a){var b=this,c=new Promise(function(c,d){b.databaseService.deleteRegister(a).then(function(){var d=b.registers.findIndex(function(b){return b._id===a});d>-1&&b.registers.splice(d,1),c()})});return c},a.prototype.removeRegisterFromFav=function(a){var b=this.registers.find(function(b){return b._id===a});b.fav=!1,this.databaseService.updateRegister(a,b)},a.prototype.removeGuestFromRegister=function(a,b){var c=this.registers.find(function(a){return a._id===b}),d=c.guests.findIndex(function(b){return b._id===a});c.guests.splice(d,1),this.databaseService.updateRegister(b,c).then(function(){console.log("guest successfully removed from register")})},a.prototype.removeVisitFromRegister=function(a,b){var c=this.registers.find(function(a){return a._id===b}),d=c.visits.findIndex(function(b){return b._id===a});c.visits.splice(d,1),this.databaseService.updateRegister(b,c).then(function(){console.log("visit successfully removed from register")})},a}())||g)),a("DataService",h)}}}),System.register("pages/visit.js",["aurelia-framework","aurelia-router","jquery","../services/data-service.js"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j,k;return{setters:[function(a){d=a.inject,e=a.BindingEngine},function(a){f=a.Router},function(a){g=a.default},function(a){h=a.DataService}],execute:function(){a("default",(i=d(f,h,e),k=i(j=function(){function a(b,d,e){var f=this;c(this,a),this.router=b,this.dataService=d,this.bindingEngine=e,this.subscriptions=[],this.tempVisit=this.createTempVisit(),this.tempWine="";var g=this.bindingEngine.propertyObserver(this,"tempWine").subscribe(function(a,b){f.wineInputChange(a,b)});this.subscriptions.push(g)}return a.prototype.activate=function(a,b,c){this.r_id=a.r_id,this.v_id=a.v_id,this.reset()},a.prototype.attached=function(){g("#add-wine-button").prop("disabled",!0)},a.prototype.detached=function(){for(var a=this.subscriptions,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;e.dispose()}},a.prototype.createTempVisit=function(){var a={date:(new Date).toISOString().slice(0,10),wines:[],notes:""};return a},a.prototype.removeWine=function(a){this.tempVisit.wines.splice(a,1)},a.prototype.addWine=function(){g("#add-wine-button").prop("disabled")||(this.tempVisit.wines.push(this.tempWine),this.tempWine="")},a.prototype.wineInputChange=function(a,b){0===a.trim().length?g("#add-wine-button").prop("disabled",!0):g("#add-wine-button").prop("disabled",!1)},a.prototype.reset=function(){this.v_id?this.tempVisit=this.dataService.getVisitById(this.v_id):this.tempVisit=this.createTempVisit()},a.prototype.save=function(){var a=this;this.v_id?(this.dataService.updateVisit(this.tempVisit),this.cancel()):this.dataService.addVisit(this.tempVisit).then(function(b){a.dataService.addVisitToRegister(b,a.r_id),a.cancel()})},a.prototype.cancel=function(){this.router.navigateToRoute("register",{r_id:this.r_id})},a}())||j)),a("default",k)}}});